# 回放功能使用指南

本指南說明如何使用撞球分析系統的回放功能，包括前端操作流程、統計分析解讀和資料管理。

---

## 目錄

1. [功能概覽](#功能概覽)
2. [前端操作流程](#前端操作流程)
3. [統計分析解讀](#統計分析解讀)
4. [資料管理](#資料管理)
5. [常見問題](#常見問題)

---

## 功能概覽

回放功能提供以下核心能力：

### 1. 錄影回放
- 觀看過往遊戲和練習的完整影片
- H.264 格式，支援流暢播放
- 事件時間軸標記，快速定位關鍵時刻

### 2. 統計分析
- **練習統計**：成功率、嘗試次數、進步曲線
- **玩家統計**：勝率、總局數、對戰記錄
- **時間範圍篩選**：本週、本月、全部

### 3. 資料查詢
- 按遊戲類型、玩家、日期篩選
- 搜尋功能
- 分頁瀏覽

---

## 前端操作流程

### 進入回放功能

1. 在左側導航欄點擊「**回放功能**」
2. 進入回放功能入口頁面，提供三個選項：
   - **個人統計分析**
   - **遊玩模式回放**
   - **練習模式回放**

### 查看個人統計

#### 步驟 1：選擇玩家
1. 點擊「**個人統計分析**」
2. 進入玩家選擇頁面
3. 可使用搜尋框快速查找玩家
4. 點擊玩家卡片進入該玩家的統計頁面

#### 步驟 2：查看統計數據
- **練習統計**：
  - 總嘗試次數
  - 成功次數
  - 成功率（附進度條視覺化）
  
- **對戰統計**：
  - 總局數
  - 勝場
  - 勝率（附進度條視覺化）

#### 步驟 3：時間範圍篩選
- 點擊「**本週**」、「**本月**」或「**全部**」按鈕
- 統計數據會自動更新

#### 步驟 4：匯出數據（開發中）
- 點擊「**匯出 CSV**」或「**匯出 JSON**」
- 下載統計數據

### 觀看遊玩模式回放

#### 步驟 1：進入列表頁面
1. 點擊「**遊玩模式回放**」
2. 顯示所有遊玩模式錄影列表

#### 步驟 2：篩選和搜尋
- **搜尋**：在搜尋框輸入關鍵字（玩家名稱、遊戲 ID）
- **排序**：選擇「按日期」或「按時長」排序

#### 步驟 3：播放錄影
1. 點擊錄影卡片上的「**播放**」按鈕
2. 進入回放播放器頁面

#### 步驟 4：使用播放器
- **影片控制**：使用 HTML5 影片控制列（播放、暫停、進度條、音量）
- **事件時間軸**：
  - 顯示遊戲中的關鍵事件
  - 點擊事件可跳轉至該時間點（需瀏覽器支援）
- **遊戲資訊**：
  - 右側面板顯示遊戲類型、日期、時長
  - 對戰資訊（玩家名稱、比分、勝者）

### 觀看練習模式回放

流程與遊玩模式相同，但錄影內容為練習模式的記錄。

---

## 統計分析解讀

### 練習成功率

**定義**：成功次數 / 總嘗試次數

**解讀**：
- **\u003c 50%**：需要加強基本功
- **50-70%**：中等水平，持續練習
- **70-85%**：良好水平
- **\u003e 85%**：優秀水平，可嘗試更高難度

**進度條顏色**：
- 白色進度條：統一視覺風格

### 玩家勝率

**定義**：勝場 / 總局數

**解讀**：
- **\u003c 40%**：需要改進策略和技術
- **40-50%**：接近平均水平
- **50-60%**：良好水平
- **\u003e 60%**：優秀水平

### 時間範圍篩選

- **本週**：過去 7 天的數據
- **本月**：當月 1 日至今的數據
- **全部**：所有歷史數據

---

## 資料管理

### 資料儲存位置

- **影片檔案**：`recordings/game_YYYYMMDD_HHMMSS/video.mjpg`
- **資料庫**：`backend/data/recordings.db`（SQLite）
- **元資料**：`recordings/game_YYYYMMDD_HHMMSS/metadata.json`（向後兼容）

### 資料備份

#### 方法 1：備份資料庫檔案
```bash
# Windows
copy backend\data\recordings.db backend\data\recordings_backup.db

# Linux/Mac
cp backend/data/recordings.db backend/data/recordings_backup.db
```

#### 方法 2：匯出為 JSON（開發中）
透過前端統計頁面的「匯出 JSON」功能

### 資料遷移

如果需要將現有錄影資料匯入資料庫：

```bash
cd backend
python migrate_recordings.py
```

**注意**：
- 遷移工具會掃描 `recordings/` 目錄
- 自動匯入 JSON/JSONL 資料至 SQLite
- 保留原始檔案結構（向後兼容）

### 刪除錄影

#### 透過 API
```bash
curl -X DELETE "http://localhost:8001/api/recordings/{game_id}"
```

#### 注意事項
- 刪除錄影會級聯刪除相關事件和統計數據
- 影片檔案需手動刪除（資料庫僅刪除索引）

---

## 常見問題

### Q1: 為什麼看不到錄影列表？

**可能原因**：
1. 尚未進行任何遊戲或練習
2. 資料庫尚未初始化
3. 後端服務未啟動

**解決方法**：
1. 先進行一場遊戲或練習
2. 執行資料遷移工具：`python backend/migrate_recordings.py`
3. 確認後端服務運行：`http://localhost:8001/api/recordings`

### Q2: 影片播放失敗怎麼辦？

**可能原因**：
1. 影片檔案損壞
2. 瀏覽器不支援 MJPEG 格式
3. 網路連線問題

**解決方法**：
1. 檢查 `recordings/` 目錄中的影片檔案是否存在
2. 使用 Chrome 或 Firefox 瀏覽器
3. 檢查後端日誌：`backend/logs/`

### Q3: 統計數據不準確？

**可能原因**：
1. 資料庫與檔案系統不同步
2. 事件記錄不完整

**解決方法**：
1. 重新執行資料遷移：`python backend/migrate_recordings.py`
2. 檢查事件日誌：`GET /api/recordings/{game_id}/events`

### Q4: 如何提升查詢效能？

**建議**：
1. 使用日期範圍篩選，避免查詢全部數據
2. 定期清理舊錄影（超過 3 個月）
3. 資料庫已自動建立索引，無需手動優化

### Q5: 可以在手機上觀看回放嗎？

**答案**：可以，前端採用響應式設計，支援手機和平板瀏覽。

**注意事項**：
- 影片播放需要穩定的網路連線
- 建議使用 WiFi 觀看，避免消耗大量行動數據

### Q6: 如何匯出統計數據？

**目前狀態**：匯出功能開發中

**替代方案**：
1. 使用 API 直接查詢：`GET /api/stats/player/{player_name}`
2. 使用 SQLite 工具直接查詢資料庫：
   ```bash
   sqlite3 backend/data/recordings.db
   SELECT * FROM players;
   ```

---

## 技術支援

如遇到其他問題，請參考：
- [API 參考文檔](../api/API_REFERENCE.md)
- [系統架構文檔](../architecture/ARCHITECTURE.md)
- [故障排除指南](../troubleshooting/)

---

**文檔版本**：v1.5.1  
**最後更新**：2026-01-19
