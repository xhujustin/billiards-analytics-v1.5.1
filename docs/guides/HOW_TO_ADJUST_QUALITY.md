# 如何調整畫質

## 📍 位置

畫質調整按鈕位於：

**前端首頁 → 📹 即時影像 → 影片下方**

```
┌─────────────────────────────────────────────┐
│  頂部導航列                                   │
│  [🟢 啟動辨識] [🔴 停止辨識]                  │
├──────────┬──────────────────────────────────┤
│          │                                  │
│  側邊欄  │  📹 即時影像                     │
│          │                                  │
│  📹 即時 │  ┌────────────────────────┐      │
│  📊 會話 │  │                        │      │
│  📋 數據 │  │    即時影像畫面        │      │
│  ⚙️ 設定 │  │                        │      │
│          │  └────────────────────────┘      │
│          │                                  │
│          │  畫質: [低] [中] [高] ← 這裡！   │
│          │  [🖼️ 全螢幕]                    │
│          │                                  │
│          │  🎯 YOLO 辨識狀態                │
│          │  📡 系統連接狀態                 │
└──────────┴──────────────────────────────────┘
```

## 🎚️ 畫質選項

點擊即時影像下方的按鈕來切換畫質：

### 低 (Low)
- **JPEG 品質**: 50
- **檔案大小**: ~20KB/幀
- **網路需求**: ~600KB/s @ 30fps
- **適用場景**:
  - 慢速網路環境
  - 快速瀏覽
  - 多人同時觀看時減輕伺服器負擔

### 中 (Med) ⭐ 預設
- **JPEG 品質**: 70
- **檔案大小**: ~50KB/幀
- **網路需求**: ~1.5MB/s @ 30fps
- **適用場景**:
  - 一般使用
  - 平衡畫質和流暢度
  - 大多數情況推薦使用

### 高 (High)
- **JPEG 品質**: 90
- **檔案大小**: ~100KB/幀
- **網路需求**: ~3MB/s @ 30fps
- **適用場景**:
  - 需要清晰看到球號標註
  - 觀察預測路徑細節
  - 高速網路環境
  - 截圖或錄影

## 🔄 切換畫質的步驟

1. **打開前端頁面**
   ```
   http://localhost:5173
   ```

2. **點擊左側邊欄的「📹 即時影像」**
   （如果已經在這個頁面，跳過此步驟）

3. **滾動到影像下方**
   找到「畫質:」標籤

4. **點擊想要的畫質按鈕**
   - 點擊 `[低]` → 切換到低畫質
   - 點擊 `[中]` → 切換到中畫質（預設）
   - 點擊 `[高]` → 切換到高畫質

5. **等待畫面更新**
   - 會顯示「🔄 切換畫質中...」提示
   - 約 0.5-1 秒後畫面恢復
   - 當前選擇的按鈕會高亮顯示

## 🎨 視覺指示

### 當前選擇的畫質
選中的按鈕會有**不同的背景色**：

```
畫質: [低] [中✓] [高]
      灰色 綠色  灰色
           ↑
       當前選擇
```

### 切換中的狀態

切換畫質時：
- 畫面會**稍微變暗** (30% 透明度)
- 中央顯示**「🔄 切換畫質中...」**提示
- 約 0.5-1 秒後恢復正常

## 📊 畫質對比

| 項目 | 低 | 中 | 高 |
|------|----|----|-----|
| JPEG 品質 | 50 | 70 | 90 |
| 檔案大小 | 小 | 中 | 大 |
| 清晰度 | ⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 流暢度 | 高 | 高 | 中 |
| 網路需求 | 低 | 中 | 高 |
| 球號可讀性 | 模糊 | 清楚 | 非常清楚 |

## 💾 自動記憶

系統會**自動記住**您選擇的畫質：
- 儲存在瀏覽器 localStorage
- 下次開啟頁面時自動套用
- 不同瀏覽器獨立記憶

## 🔍 驗證畫質是否生效

### 方法 1: 視覺檢查
- **低畫質**: 球號標註有明顯壓縮痕跡，邊緣模糊
- **中畫質**: 球號清晰可讀，畫面流暢
- **高畫質**: 球號非常清晰，預測路徑細節清楚

### 方法 2: 瀏覽器開發者工具
1. 按 `F12` 打開開發者工具
2. 切換到 `Network` 面板
3. 點擊畫質按鈕
4. 查看新的請求 URL：
   ```
   低: /burnin/camera1.mjpg?quality=low&_t=16
   中: /burnin/camera1.mjpg?quality=med&_t=17
   高: /burnin/camera1.mjpg?quality=high&_t=18
   ```

### 方法 3: 瀏覽器 Console
1. 按 `F12` 打開開發者工具
2. 切換到 `Console` 面板
3. 點擊畫質按鈕
4. 查看日誌輸出：
   ```
   🎨 Quality changed: med → high
   🎨 Quality state: high, streamKey: 18
   📺 Burnin URL: /burnin/camera1.mjpg?quality=high&_t=18
   ✅ Stream loaded successfully
   ```

### 方法 4: 後端日誌
查看後端終端輸出：
```bash
🎬 Burnin stream requested: camera1, quality=high (JPEG=90)
🎨 monitor stream starting with quality=90
```

## 🐛 故障排除

### 問題 1: 點擊按鈕沒有反應

**檢查**:
1. 確認已在「📹 即時影像」頁面
2. 檢查瀏覽器 Console 是否有錯誤
3. 重新整理頁面 (F5)

### 問題 2: 畫質沒有變化

**檢查**:
1. 打開開發者工具 → Console
2. 確認看到「🎨 Quality changed」訊息
3. 確認後端日誌有「Burnin stream requested」
4. 檢查網路連接

**解決**:
```bash
# 重啟前端
cd frontend
npm run dev

# 重啟後端
cd backend
python main.py
```

### 問題 3: 切換後畫面黑屏

**原因**:
- 網路延遲
- 後端處理較慢

**解決**:
- 已添加載入提示，等待 1-2 秒
- 如果超過 3 秒仍黑屏，重新整理頁面

### 問題 4: 高畫質卡頓

**原因**:
- 網路頻寬不足
- CPU 處理能力不夠

**解決**:
- 切換回「中」或「低」畫質
- 檢查網路速度
- 關閉其他佔用網路的程式

## 🚀 最佳實踐

### 一般使用
推薦使用 **「中」畫質**：
- 平衡畫質和效能
- 球號清晰可讀
- 網路需求適中

### 觀看球號標註
推薦使用 **「高」畫質**：
- 球號非常清晰
- 預測路徑細節清楚
- 適合仔細分析

### 慢速網路
推薦使用 **「低」畫質**：
- 降低網路需求
- 保持流暢度
- 避免卡頓

### 多人同時觀看
推薦使用 **「低」或「中」畫質**：
- 減輕伺服器負擔
- 降低總頻寬需求
- 每個用戶可獨立選擇

## 📱 不同設備建議

| 設備 | 推薦畫質 | 理由 |
|------|----------|------|
| 桌機（有線網路） | 高 | 網路穩定，螢幕大 |
| 筆電（WiFi） | 中 | 平衡效能和畫質 |
| 平板 | 中 | 螢幕適中 |
| 手機 | 低-中 | 螢幕小，省流量 |

## 🎓 技術說明

### 畫質映射
```python
quality_map = {
    "low":  50,   # JPEG quality
    "med":  70,
    "high": 90
}
```

### URL 格式
```
/burnin/camera1.mjpg?quality=high&_t=18
                     ↑           ↑
                     畫質參數    時間戳（防緩存）
```

### 快取機制
- 後端會緩存最多 3 種畫質的編碼
- 相同畫質的多個客戶端共享緩存
- 每個新幀會清空舊緩存

## 相關文件

- [QUALITY_CONTROL_FIX.md](QUALITY_CONTROL_FIX.md) - 技術實作細節
- [QUICK_START.md](QUICK_START.md) - 快速啟動指南
- [YOLO_CONTROL_UI.md](YOLO_CONTROL_UI.md) - UI 使用說明

---

**更新時間**: 2026-01-05
**適用版本**: v1.5.0
